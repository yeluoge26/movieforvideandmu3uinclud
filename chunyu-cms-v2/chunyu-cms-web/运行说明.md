# 🚀 本地运行说明

## 当前状态

✅ **已完成:**
- Node.js v24.12.0 已安装
- pnpm 已安装并配置
- 项目依赖已安装完成 (1373个包)
- 开发服务器已启动（后台运行）

⚠️ **需要配置:**

### 1. 创建 `.env` 文件

在 `chunyu-cms-web` 目录下创建 `.env` 文件，配置数据库和Redis连接信息：

```env
# 数据库配置（必须修改密码）
DATABASE_USERNAME=root
DATABASE_PASSWORD=你的MySQL密码
DATABASE_HOST=127.0.0.1
DATABASE_PORT=3306
DATABASE_DB=chunyu-cms-v2

# JWT配置
JWT_SECRET=chunyu-cms-v2

# Redis配置
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_USERNAME=
REDIS_PASSWORD=
REDIS_DB=0

# 应用配置
IS_DEMO_ENVIRONMENT=false
SERVER_HOST=http://localhost:3000
IMG_HOST=http://localhost:3000
ANTI_DEBUG_ENABLED=false
```

### 2. 启动 MySQL 服务

```powershell
# Windows服务方式
net start MySQL80

# 或使用XAMPP/WAMP等工具启动MySQL
```

### 3. 启动 Redis 服务

```powershell
# Windows服务方式
net start Redis

# 或直接运行
redis-server

# 或使用Docker
docker run -d -p 6379:6379 redis
```

### 4. 初始化数据库

```sql
-- 创建数据库
CREATE DATABASE `chunyu-cms-v2` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

然后在命令行执行：
```bash
mysql -u root -p chunyu-cms-v2 < chunyu-cms-v2.sql
```

## 启动命令

### 开发模式
```powershell
cd chunyu-cms-v2\chunyu-cms-web
pnpm dev
```

访问地址: http://localhost:3000

### 查看运行状态
开发服务器已在后台运行，如果遇到连接错误，请：
1. 检查MySQL和Redis是否已启动
2. 检查 `.env` 文件配置是否正确
3. 查看终端输出的错误信息

## 新增功能

### 1. 数据库清理API
清理所有数据但保留基础类别（columns和genre）：

```powershell
# PowerShell
Invoke-WebRequest -Uri http://localhost:3000/api/admin/database/clean -Method POST

# 或使用curl
curl -X POST http://localhost:3000/api/admin/database/clean
```

### 2. TikTok风格首页
首页已改造为TikTok风格：
- ✅ 全屏视频流展示
- ✅ 上下滑动切换
- ✅ 沉浸式体验
- ✅ 视频信息展示
- ✅ 操作按钮（点赞、收藏、分享）

访问 http://localhost:3000 即可体验新界面。

## 故障排查

### MySQL连接失败
```
Error: connect ECONNREFUSED 127.0.0.1:3306
```
**解决:** 启动MySQL服务，检查 `.env` 中的数据库配置

### Redis连接失败
```
Error: connect ECONNREFUSED 127.0.0.1:6379
```
**解决:** 启动Redis服务，或暂时注释掉Redis相关代码

### 端口被占用
```
Error: listen EADDRINUSE: address already in use :::3000
```
**解决:** 
- 关闭占用3000端口的程序
- 或修改端口: `pnpm dev --port 3001`

## 下一步

1. ✅ 创建 `.env` 文件并配置数据库信息
2. ✅ 启动MySQL和Redis服务
3. ✅ 初始化数据库
4. ✅ 访问 http://localhost:3000 查看TikTok风格首页
5. ✅ (可选) 调用清理API清理测试数据

## 管理端启动（可选）

如果需要启动管理后台：

```powershell
cd chunyu-cms-v2\chunyu-cms-admin
pnpm install
pnpm dev
```

访问: http://localhost:4000
- 用户名: admin
- 密码: admin123
